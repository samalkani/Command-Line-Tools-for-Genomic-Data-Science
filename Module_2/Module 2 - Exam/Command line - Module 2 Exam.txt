Copy the tar.gz file the Exam folder
[guest@centos6 sf_Spyder_Scripts]$ cp gencommand_proj2_data.tar.gz Exam/
Display tar.gz file in Exam folder
[guest@centos6 sf_Spyder_Scripts]$ ls Exam
gencommand_proj1_data  gencommand_proj1_data.tar  gencommand_proj2_data.tar.gz
Change Directory to Exam Folder
[guest@centos6 sf_Spyder_Scripts]$ cd Exam
Un-gzip the file
[guest@centos6 Exam]$ gunzip gencommand_proj2_data.tar.gz
Display Size of tar file
[guest@centos6 Exam]$ ls -l gencommand_proj2_data.tar
-rwxrwx---. 1 root vboxsf 10127360 Jul 18 05:28 gencommand_proj2_data.tar
Un-tar file in Exam Folder
[guest@centos6 Exam]$ tar -xvf gencommand_proj2_data.tar
athal_wu_0_A.bam
athal_wu_0_A.bam.bai
athal_wu_0_A_annot.gtf
samalkani@WINDELL-NURVN2D:/mnt/c/Python_Scripts/Spyder_Scripts/Exam$ ls
Display Exam folder contents
[guest@centos6 Exam]$ ls -lt
total 135512
-rwxrwx---. 1 root vboxsf  10127360 Jul 18 05:28 gencommand_proj2_data.tar
-rwxrwx---. 1 root vboxsf 118507520 Jul 13 06:59 gencommand_proj1_data.tar
-rwxrwx---. 1 root vboxsf      2912 Jul 21  2015 athal_wu_0_A_annot.gtf
-rwxrwx---. 1 root vboxsf      6720 Jul 19  2015 athal_wu_0_A.bam.bai
-rwxrwx---. 1 root vboxsf  10104976 Jul 19  2015 athal_wu_0_A.bam
drwxrwx---. 1 root vboxsf      4096 Jun 11  2015 gencommand_proj1_data
Re-organise folders and files into folders Module_1 and Module_2 in the Exam Folder
Make Folders
[guest@centos6 Exam]$ mkdir Module_1
[guest@centos6 Exam]$ mkdir Module_2
Move files into new folders
 [guest@centos6 Exam]$ mv gencommand_proj2_data.tar Module_2
[guest@centos6 Exam]$ mv athal_wu_0_A_annot.gtf  Module_2
[guest@centos6 Exam]$ mv athal_wu_0_A.bam.bai Module_2
[guest@centos6 Exam]$ mv athal_wu_0_A.bam Module_2
[guest@centos6 Exam]$ mv gencommand_proj1_data.tar Module_1
[guest@centos6 Exam]$ mv gencommand_proj1_data Module_1
List new folders in Exam folder
[guest@centos6 Exam]$ ls 
Module_1  Module_2
List Module_1 folder
[guest@centos6 Exam]$ ls Module_1
gencommand_proj1_data  gencommand_proj1_data.tar
List Module_2 folder
[guest@centos6 Exam]$ ls Module_2
athal_wu_0_A_annot.gtf  athal_wu_0_A.bam  athal_wu_0_A.bam.bai  gencommand_proj2_data.tar
Change Directory to Module_2
[guest@centos6 Exam]$ cd Module_2
List Module_2 contents
[guest@centos6 Module_2]$ ls
athal_wu_0_A_annot.gtf  athal_wu_0_A.bam  athal_wu_0_A.bam.bai  gencommand_proj2_data.tar
Question 1 - How many alignments does the set contain?
[guest@centos6 Module_2]$ samtools flagstat athal_wu_0_A.bam
221372 + 0 in total (QC-passed reads + QC-failed reads)
0 + 0 secondary
0 + 0 supplementary
20419 + 0 duplicates
218469 + 0 mapped (98.69%:-nan%)
155851 + 0 paired in sequencing
77895 + 0 read1
77956 + 0 read2
142663 + 0 properly paired (91.54%:-nan%)
150045 + 0 with itself and mate mapped
2903 + 0 singletons (1.86%:-nan%)
4938 + 0 with mate mapped to a different chr
2120 + 0 with mate mapped to a different chr (mapQ>=5)
221372

Question 2 - How many alignments show the read’s mate unmapped?
Target the 7th column the ‘*’ sign indicates that the reads mate is unmapped to the same chromosome
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 7 | grep '*' | head -4
*
*
*
*
Count the lines
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 7 | grep '*' | wc -l
65521

Question 3 - How many alignments contain a deletion (D)?
Target the cigar string which is the 6th column in the bam file
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 6 | grep 'D' | head -4
33M2D3M (2 deletions)
21M1D30M (1 deletion)
10M3I6M4D17M (4 deletions)
26M1D25M (1 deletion)
Count the lines which contain cigar strings with the letter ‘D’, either using ‘grep –c’ or ‘wc –l’
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 6 | grep -c 'D'
2451
Or
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 6 | grep 'D' | wc -l
2451

Question 4 - How many alignments show the read mapped to the same chromosome?
Target the 7th column the ‘=’ sign indicates that the read is mapped to the same chromosome
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 7 | grep '=' | head -4
=
=
=
=
Then count the number of lines
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 7 | grep '=' | wc -l
150913

Question 5 – How many alignments are spliced?
Target the 6th column the ‘N’ sign indicates a spliced alignment (i.e. introns in-between exons)
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 6 | grep 'N' | wc -l
0
or
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | cut -f 6 | grep -c 'N' 
0

Question 6 – How many alignments does the set contain
Sort the bam file
[guest@centos6 Module_2]$ samtools sort athal_wu_0_A.bam athal_wu_0_A.sort.bam
Index the bam file
[guest@centos6 Module_2]$ samtools index athal_wu_0_A.sort.bam
Extract range “Chr3:11,777,000-11,794,000”
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.sort.bam “Chr3:11, 777, 000-11, 794, 000” | wc -l
7081

Question 7 - How many alignments show the reads mate unmapped?
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.sort.bam “Chr3:11, 777, 000-11, 794, 000” | cut -f 7 | grep '*' | wc -l
1983

Question 8 – How many alignments contain a deletion (D)?
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.sort.bam “Chr3:11, 777, 000-11, 794, 000” | cut –f 6 ~ grep ‘D’| wc –l
31

Question 9 – How many alignments show the read’s mate mapped to the same chromosome?
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.sort.bam “Chr3:11, 777, 000-11, 794, 000” | cut –f 7 ~ grep ‘=’| wc –l
4670

Question 10 – How many alignments are spliced?
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.sort.bam “Chr3:11, 777, 000-11, 794, 000” | cut –f 6 ~ grep ‘N’| wc –l
0

Question 11 – How many sequences are in the genome file?
[guest@centos6 Module_2]$ samtools view -H athal_wu_0_A.bam 
@HD	VN:1.0	GO:none	SO:coordinate
@SQ	SN:Chr1	LN:29923332	AS:wu_0.v7.fas	SP:wu_0.v7.fas
@SQ	SN:Chr2	LN:19386101	AS:wu_0.v7.fas	SP:wu_0.v7.fas
@SQ	SN:Chr3	LN:23042017	AS:wu_0.v7.fas	SP:wu_0.v7.fas
@SQ	SN:Chr4	LN:18307997	AS:wu_0.v7.fas	SP:wu_0.v7.fas
@SQ	SN:Chr5	LN:26567293	AS:wu_0.v7.fas	SP:wu_0.v7.fas
@SQ	SN:chloroplast	LN:154478	AS:wu_0.v7.fas	SP:wu_0.v7.fas
@SQ	SN:mitochondria	LN:366924	AS:wu_0.v7.fas	SP:wu_0.v7.fas
@RG	ID:H100223_GAII05_0002	PL:SLX	LB:wu_PII	PI:400	DS:wu_0_Genome	SM:wu_0
@RG	ID:Wii_PER01	PL:SLX	LB:wu_phaseI	PI:400	DS:wu_0_Genome	SM:wu_0
@RG	ID:Wii_PER02	PL:SLX	LB:wu_phaseI	PI:400	DS:wu_0_Genome	SM:wu_0
@RG	ID:Wii_SR03	PL:SLX	LB:wu_phaseI	PI:400	DS:wu_0_Genome	SM:wu_0
@PG	ID:stampy	VN:1.0.3_(r627)	CL:-g /lustre/scratch103/sanger/xcg/tmp/tmp.zYfXz26246 -h /lustre/scratch103/sanger/xcg/tmp/tmp.zYfXz26246 --readgroup=ID:Wii_PER01,LB:wu_phaseI,SM:wu_0,PI:400,PL:SLX,DS:wu_0_Genome --bwaoptions=-q10 /lustre/scratch103/sanger/xcg/wu_0.v7.fas -o /lustre/scratch103/sanger/xcg/wu_0/A/aln_A1.sp0.sam -M /lustre/scratch103/sanger/xcg/wu_0/read_1_1.sp0.fq.gz /lustre/scratch103/sanger/xcg/wu_0/read_1_2.sp0.fq.gz
@CO	TM:Fri, 17 Sep 2010 12:20:13 BST	WD:/lustre/scratch103/sanger/xcg/wu_0/self	HN:bc-16-1-07.internal.sanger.ac.uk	UN:xcg
7

Question 12 – What is the length of the sequence in the genome file?
@SQ	SN:Chr1	LN:29923332	AS:wu_0.v7.fas	SP:wu_0.v7.fas
29923332

Question 13 - What alignment tool was used?
@PG	ID:stampy
Stampy

Question 14 – What is the read identifier (name) for the first alignment?
[guest@centos6 Module_2]$ samtools view athal_wu_0_A.bam | head -1
GAII05_0002:1:113:7822:3886#0	1187	Chr3	11699950	60	51M	=	11700332	433	AAAAAAAATGTAAAACTGCTAAATCTCTCCTCTCTAAAGAACTCGTCCCCG	CCCCCCBBBCCCCCCCCCCCCCCCCCCCCCCCCCCCBAAB??@ACBBCCCD	PQ:i:21	SM:i:37	UQ:i:0	MQ:i:37	XQ:i:0	RG:Z:H100223_GAII05_0002
GAII05_0002:1:113:7822:3886#0

Question 15 – What is the start position of this read’s mate on the genome? Give this as ‘chrom:pos’ if the read was mapped, or ‘* if unmapped’.
Chr3: 11700332
Chr3: 11700332

Question 16 – How many overlaps (each overlap is reported on one line) are reported?
Convert the bam file to a bed file so that you can perform the intersection operation between the gtf file and a bed file
[guest@centos6 Module_2]$ bedtools bamtobed -i athal_wu_0_A.bam > athal_wu_0_A.bed
Intersection operation with –wo 
[guest@centos6 Module_2]$ bedtools intersect -wo -a athal_wu_0_A_annot.gtf -b athal_wu_0_A.bed | wc -l
3101

Question 17 – How many of these are 10 bases or longer?
The number of bases that are overlapped between the gtf and the bed files is in the 16th column so using the –cut command we can select that column and pipe it into a text file.
[guest@centos6 Module_2]$ bedtools intersect -wo -a athal_wu_0_A_annot.gtf -b athal_wu_0_A.bed | cut -f16 > count.txt
To select the values in the 1st and only column in the count.txt file greater than 9 use the awk command below.
[guest@centos6 Module_2]$ awk '$1>9{c++} END{print c+0}' count.txt
2899

Question 18 - How many alignments overlap the annotations?
[guest@centos6 Module 2 - Exam]$ bedtools intersect -wo -a athal_wu_0_A_annot.gtf -b athal_wu_0_A.bed | cut -f4 |  wc -l
3101

Question 19 – Conversely how many exons have reads matched to them?
[guest@centos6 Module_2]$ bedtools intersect -wo -a athal_wu_0_A_annot.gtf -b athal_wu_0_A.bed | cut -f4 | sort -u | wc -l
21

Question 20 – If you were to convert the transcript annotations in the file “athal_wu_0_A_annot.gtf” into BED format, how many BED records would be generated?
[guest@centos6 Module_2]$ bedtools intersect -wo -a athal_wu_0_A_annot.gtf -b athal_wu_0_A.bed | cut -f9 | cut -d " " -f4 | sort -u | wc -l
4
