Unzipping + un-tarring files
[guest@centos6 /]$ cd media/sf_Spyder_Scripts/Exam
[guest@centos6 Exam]$ ls
Module_1  Module_2  Module_3
[guest@centos6 Exam]$ mkdir Module_4
[guest@centos6 Exam]$ cd..
[guest@centos6 sf_Spyder_Scripts]$ ls gencommand*
gencommand_proj1_data.tar.gz  gencommand_proj3_data.tar.gz
gencommand_proj2_data.tar.gz  gencommand_proj4.tar.gz
[guest@centos6 sf_Spyder_Scripts]$ ls Exam
Module_1  Module_2  Module_3  Module_4
[guest@centos6 sf_Spyder_Scripts]$ cp gencommand_proj4.tar.gz Exam/Module_4
[guest@centos6 sf_Spyder_Scripts]$ cd Exam/Module_4
[guest@centos6 Module_4]$ ls
gencommand_proj4.tar.gz
[guest@centos6 Module_4]$ gunzip gencommand_proj4.tar.gz
[guest@centos6 Module_4]$ ls -l
total 21612
-rwxrwx---. 1 root vboxsf 22128640 Jul 23 12:52 gencommand_proj4.tar
[guest@centos6 Module_4]$ tar -xvf gencommand_proj4.tar
gencommand_proj4/
gencommand_proj4/athal_chr.fa
gencommand_proj4/athal_genes.gtf
gencommand_proj4/Day8.fastq
gencommand_proj4/Day16.fastq
gencommand_proj4/commands.tar.gz
[guest@centos6 Module_4]$ ls
gencommand_proj4  gencommand_proj4.tar
Alignment of RNA-seq datasets (Day 8 and Day 16)
Create directories for Tophat output for Day 8 and Day 16
mkdir Tophat
mkdir Tophat/Day8
mkdir Tophat/Day16
Create directory for Bowtie Index for the Athal genome
mkdir athal
Create Bowtie Index for the genome Athal
bowtie2-build athal_chr.fa athal/athal
Copy Athal genome to athal directory
cp athal_chr.fa athal/
Output alignment from tophat to Day8 directory
Use the Athal genome index and Day 8 input read
tophat –o Tophat/Day8/ athal/athal Day8.fastq
List Tophat Files for Day 8
[guest@centos6 gencommand_proj4]$ ls Tophat/Day8
accepted_hits.bam  deletions.bed   junctions.bed  prep_reads.info
align_summary.txt  insertions.bed  logs           unmapped.bam
Output alignment from tophat to Day16 directory
Use the Athal genome index and Day 16 input read
tophat –o Tophat/Day16 athal/athal Day16.fastq
List Tophat files for Day 16
[guest@centos6 gencommand_proj4]$ ls Tophat/Day16
accepted_hits.bam  deletions.bed   junctions.bed  prep_reads.info
align_summary.txt  insertions.bed  logs           unmapped.bam
Question 1 - How many alignments were produced for the ‘Day8’ RNA-seq data set?
[guest@centos6 gencommand_proj4]$ samtools view Tophat/Day8/accepted_hits.bam | cut -f7 | wc -l
63845
Question 2 - How many alignments were produced for the ‘Day16’ RNA-seq data set?
[guest@centos6 gencommand_proj4]$ samtools view Tophat/Day16/accepted_hits.bam | cut -f7 | wc -l
58398
Question 3 - How many reads were mapped in ‘Day8’ RNA-seq data set?
[guest@centos6 gencommand_proj4]$ head Tophat/Day8/align_summary.txt
Reads:
          Input     :     63573
           Mapped   :     63489 (99.9% of input)
            of these:       356 ( 0.6%) have multiple alignments (0 have >20)
99.9% overall read mapping rate.
63489
Question 4 - How many reads were mapped in ‘Day16’ RNA-seq data set?
[guest@centos6 gencommand_proj4]$ head Tophat/Day16/align_summary.txt
Reads:
          Input     :     57985
           Mapped   :     57951 (99.9% of input)
            of these:       447 ( 0.8%) have multiple alignments (0 have >20)
99.9% overall read mapping rate.
57951
Question 5 - How many reads were uniquely aligned in ‘Day8’ RNA-seq data set?
63489 - 356 = 63133
Question 6 - How many reads were uniquely aligned in ‘Day16’ RNA-seq data set?
57951 – 447 = 57504
Question 7 - How many spliced alignments were reported for ‘Day8’ RNA-seq data set?
[guest@centos6 gencommand_proj4]$ samtools view Tophat/Day8/accepted_hits.bam | cut -f6 | grep "N" | wc -l
8596
Question 8 - How many spliced alignments were reported for ‘Day16’ RNA-seq data set?
[guest@centos6 gencommand_proj4]$ samtools view Tophat/Day16/accepted_hits.bam | cut -f6 | grep "N" | wc -l
10695
Question 9 - How many reads were left unmapped from ‘Day8’ RNA-seq data set?
63573 – 63489 = 84
Question 10 - How many reads were left unmapped from ‘Day16’ RNA-seq data set?
57985 – 57951 = 34
Create directories for assembly output from cufflinks
[guest@centos6 gencommand_proj4]$ mkdir Cufflinks
[guest@centos6 gencommand_proj4]$ mkdir Cufflinks/Day8
[guest@centos6 gencommand_proj4]$ mkdir Cufflinks/Day16
Question 11 - How many genes were generated by cufflinks for Day8?
Use Tophat file accepted_hits.bam to assemble aligned reads into transcripts
[guest@centos6 gencommand_proj4]$ cufflinks -L Day8 Tophat/Day8/accepted_hits.bam -o Cufflinks/Day8
Warning: Could not connect to update server to verify current version. Please check at the Cufflinks website (http://cufflinks.cbcb.umd.edu).
[15:38:34] Inspecting reads and determining fragment length distribution.
> Processed 321 loci.                          [*************************] 100%
> Map Properties:
>	Normalized Map Mass: 63489.00
>	Raw Map Mass: 63489.00
>	Fragment Length Distribution: Truncated Gaussian (default)
>	              Default Mean: 200
>	           Default Std Dev: 80
[15:38:34] Assembling transcripts and estimating abundances.
> Processed 327 loci.                          [*************************] 100%
List Cufflinks assembly files for Day 8
[guest@centos6 gencommand_proj4]$ ls Cufflinks/Day8
genes.fpkm_tracking  isoforms.fpkm_tracking  skipped.gtf  transcripts.gtf
Use gene annotation file transcripts.gtf to count how many genes were generated for Day 8
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ";" -f1 | sort -u | wc -l
186
Question 12 - How many genes were generated by cufflinks for Day16?
Use Tophat file accepted_hits.bam to assemble aligned reads into transcripts
[guest@centos6 gencommand_proj4]$ cufflinks -L Day16 Tophat/Day16/accepted_hits.bam -o Cufflinks/Day16
Warning: Could not connect to update server to verify current version. Please check at the Cufflinks website (http://cufflinks.cbcb.umd.edu).
[15:54:56] Inspecting reads and determining fragment length distribution.
> Processed 139 loci.                          [*************************] 100%
> Map Properties:
>	Normalized Map Mass: 57951.00
>	Raw Map Mass: 57951.00
>	Fragment Length Distribution: Truncated Gaussian (default)
>	              Default Mean: 200
>	           Default Std Dev: 80
[15:54:56] Assembling transcripts and estimating abundances.
> Processed 161 loci.                          [*************************] 100%
List Cufflinks assembly files for Day 16
[guest@centos6 gencommand_proj4]$ ls Cufflinks/Day16
genes.fpkm_tracking  isoforms.fpkm_tracking  skipped.gtf  transcripts.gtf
Use gene annotation file transcripts.gtf to count how many genes were generated for Day 16
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ";" -f1 | sort -u | wc -l
80
Question 13 - How many transcripts were reported for Day8?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ";" -f2 | sort -u | wc -l
192
Question 14 - How many transcripts were reported for Day16?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ";" -f2 | sort -u | wc -l
92
Question 15 - How many single transcript genes were produced for Day8?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ' ' -f2,4 | sort -u | cut -d ' ' -f1 | sort | uniq -c |  grep -c " 1 "
180
Question 16 - How many single transcript genes were produced for Day16?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ' ' -f2,4 | sort -u | cut -d ' ' -f1 | sort | uniq -c |  grep -c " 1 "
69
Question 17 - How many single-exon transcripts were in the Day8 set?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ' ' -f4 | sort | uniq -c |  grep -c " 2 "
119
Question 18 - How many single-exon transcripts were in the Day16 set?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ' ' -f4 | sort | uniq -c |  grep -c " 2 "
24
Question 19 - How many multi-exon transcripts were in the Day8 set?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ' ' -f4 | sort | uniq -c |  grep -v -c " 2 "
73
Question 20 - How many multi-exon transcripts were in the Day16 set?
[guest@centos6 gencommand_proj4]$ cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ' ' -f4 | sort | uniq -c |  grep -v -c " 2 "
68
Question 21 – How many cufflinks transcripts fully reconstruct annotation transcripts in Day 8?
[guest@centos6 gencommand_proj4]$ cd Cufflinks/Day8
[guest@centos6 Day8]$ cuffcompare -r /media/sf_Spyder_Scripts/Exam/Module_4/gencommand_proj4/athal_genes.gtf -R transcripts.gtf
Warning: Could not connect to update server to verify current version. Please check at the Cufflinks website (http://cufflinks.cbcb.umd.edu).
[guest@centos6 Day8]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "=" | wc -l
16
Question 22 – How many cufflinks transcripts fully reconstruct annotation transcripts in Day 16?
[guest@centos6 Day8]$ cd ..
[guest@centos6 Cufflinks]$ cd ..
[guest@centos6 gencommand_proj4]$ cd Cufflinks/Day16
[guest@centos6 Day16]$ cuffcompare -r /media/sf_Spyder_Scripts/Exam/Module_4/gencommand_proj4/athal_genes.gtf -R transcripts.gtf
Warning: Could not connect to update server to verify current version. Please check at the Cufflinks website (http://cufflinks.cbcb.umd.edu).
[guest@centos6 Day16]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "=" | wc -l
36
Question 23 - How many splice variants does the gene AT4G20240 have in the Day8 sample?
[guest@centos6 Day16]$ cd ../Day8
[guest@centos6 Day8]$ cat cuffcmp.transcripts.gtf.tmap | grep "AT4G20240" | wc -l
2
Question 24 - How many splice variants does the gene AT4G20240 have in the Day16 sample?
[guest@centos6 Day8]$ cd ../Day16
[guest@centos6 Day16]$ cat cuffcmp.transcripts.gtf.tmap | grep "AT4G20240" | wc -l
0
Question 25 - How many cufflinks transcripts are partial reconstructions of reference transcripts (‘contained’)? (Day8)
[guest@centos6 Day16]$ cd ../Day8
[guest@centos6 Day8]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "c" | wc -l
133
Question 26 - How many cufflinks transcripts are partial reconstructions of reference transcripts (‘contained’)? (Day16)
[guest@centos6 Day8]$ cd ../Day16
[guest@centos6 Day16]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "c" | wc -l
21
Question 27 - How many cufflinks transcripts are novel splice variants of reference genes? (Day8)
[guest@centos6 Day8]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "j" | wc -l
14
Question 28 - How many cufflinks transcripts are novel splice variants of reference genes? (Day16)
[guest@centos6 Day8]$ cd ../Day16
[guest@centos6 Day16]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "j" | wc -l
22
Question 29 - How many cufflinks transcripts were formed in the introns of reference genes? (Day8)
[guest@centos6 Day16]$ cd ../Day8
[guest@centos6 Day8]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "i" | wc -l
4
Question 30 - How many cufflinks transcripts were formed in the introns of reference genes? (Day16)
[guest@centos6 Day8]$ cd ../Day16
[guest@centos6 Day16]$ cat cuffcmp.transcripts.gtf.tmap | cut -f3 | grep "i" | wc -l
1
Un-zip and un-tar commands files
[guest@centos6 gencommand_proj4]$ gunzip commands.tar.gz
[guest@centos6 gencommand_proj4]$ tar -xvf commands.tar
commands/
commands/com.cuffdiff
commands/GTFs.txt
commands/com.cufflinks
commands/com.tophat
rewrite the GTFs.txt with the location of gtf files which would like merged
[guest@centos6 gencommand_proj4]$ vi commands/GTFs.txt
/media/sf_Spyder_Scripts/Exam/Module_4/gencommand_proj4/Cufflinks/Day8/transcripts.gtf
/media/sf_Spyder_Scripts/Exam/Module_4/gencommand_proj4/Cufflinks/Day16/transcripts.gtf
Question 31 - How many genes (loci) were reported in the merged.gtf file?
Run Cuffmerge
cuffmerge -g athal_genes.gtf commands/GTFs.txt
List the files from the Cuffmerge
[guest@centos6 gencommand_proj4]$ ls merged_asm
genes.fpkm_tracking     logs        skipped.gtf  tmp_meta_asm.transcripts.gtf.refmap  transcripts.gtf
isoforms.fpkm_tracking  merged.gtf  tmp          tmp_meta_asm.transcripts.gtf.tmap
How many genes(loci) were reported in the merged.gtf file
[guest@centos6 gencommand_proj4]$ cat merged_asm/merged.gtf | cut -f9 | cut -d ' ' -f2 | sort -u | wc -l
129
Question 32 – How many transcripts?
[guest@centos6 gencommand_proj4]$ cat merged_asm/merged.gtf | cut -f9 | cut -d ' ' -f4 | sort -u | wc -l
200
Question 33 - How many genes total were included in the gene expression report from cuffdiff?
Create a new directory Cuffdiff to put output files from Cuffdiff procedure
[guest@centos6 gencommand_proj4]$ mkdir Cuffdiff
List File created by Cuffdiff procedure
[guest@centos6 gencommand_proj4]$ ls Cuffdiff
bias_params.info         genes.fpkm_tracking           run.info
cds.count_tracking       genes.read_group_tracking     splicing.diff
cds.diff                 isoform_exp.diff              tss_group_exp.diff
cds_exp.diff             isoforms.count_tracking       tss_groups.count_tracking
cds.fpkm_tracking        isoforms.fpkm_tracking        tss_groups.fpkm_tracking
cds.read_group_tracking  isoforms.read_group_tracking  tss_groups.read_group_tracking
gene_exp.diff            promoters.diff                var_model.info
genes.count_tracking     read_groups.info
How many genes were included in the gene expression report
[guest@centos6 gencommand_proj4]$ cat Cuffdiff/gene_exp.diff | wc -l
129
Question 34 - How many genes were detected as differentially expressed?
[guest@centos6 gencommand_proj4]$ cat Cuffdiff/gene_exp.diff | cut -f14 | grep "yes" | wc -l
4
Question 35 – How many transcripts were differentially expressed between the two samples?
[guest@centos6 gencommand_proj4]$ cat Cuffdiff/isoform_exp.diff | cut -f14 | grep "yes" | wc -l
5
